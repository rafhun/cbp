if(typeof (Prototype)=="undefined"){throw"Control.Tabs requires Prototype to be loaded."}if(typeof (Object.Event)=="undefined"){throw"Control.Tabs requires Object.Event to be loaded."}Control.Tabs=Class.create({initialize:function(C,B){if(!$(C)){throw"Control.Tabs could not find the element: "+C}this.activeContainer=false;this.activeLink=false;this.containers=$H({});this.links=[];Control.Tabs.instances.push(this);this.options={beforeChange:Prototype.emptyFunction,afterChange:Prototype.emptyFunction,hover:false,linkSelector:"li a",setClassOnContainer:false,activeClassName:"active",defaultTab:"first",autoLinkExternal:true,targetRegExp:/#(.+)$/,showFunction:Element.show,hideFunction:Element.hide};Object.extend(this.options,B||{});(typeof (this.options.linkSelector=="string")?$(C).select(this.options.linkSelector):this.options.linkSelector($(C))).findAll(function(D){return(/^#/).exec((Prototype.Browser.WebKit?decodeURIComponent(D.href):D.href).replace(window.location.href.split("#")[0],""))}).each(function(D){this.addTab(D)}.bind(this));this.containers.values().each(Element.hide);if(this.options.defaultTab=="first"){this.setActiveTab(this.links.first())}else{if(this.options.defaultTab=="last"){this.setActiveTab(this.links.last())}else{this.setActiveTab(this.options.defaultTab)}}var A=this.options.targetRegExp.exec(window.location);if(A&&A[1]){A[1].split(",").each(function(D){this.setActiveTab(this.links.find(function(E){return E.key==D}))}.bind(this))}if(this.options.autoLinkExternal){$A(document.getElementsByTagName("a")).each(function(D){if(!this.links.include(D)){var E=D.href.replace(window.location.href.split("#")[0],"");if(E.substring(0,1)=="#"){if(this.containers.keys().include(E.substring(1))){$(D).observe("click",function(G,F){this.setActiveTab(F.substring(1))}.bindAsEventListener(this,E))}}}}.bind(this))}},addTab:function(B){this.links.push(B);B.key=B.getAttribute("href").replace(window.location.href.split("#")[0],"").split("/").last().replace(/#/,"");var A=$(B.key);if(!A){throw"Control.Tabs: #"+B.key+" was not found on the page."}this.containers.set(B.key,A);B[this.options.hover?"onmouseover":"onclick"]=function(C){if(window.event){Event.stop(window.event)}this.setActiveTab(C);return false}.bind(this,B)},setActiveTab:function(A){if(!A&&typeof (A)=="undefined"){return }if(typeof (A)=="string"){this.setActiveTab(this.links.find(function(B){return B.key==A}))}else{if(typeof (A)=="number"){this.setActiveTab(this.links[A])}else{if(this.notify("beforeChange",this.activeContainer,this.containers.get(A.key))===false){return }if(this.activeContainer){this.options.hideFunction(this.activeContainer)}this.links.each(function(B){(this.options.setClassOnContainer?$(B.parentNode):B).removeClassName(this.options.activeClassName)}.bind(this));(this.options.setClassOnContainer?$(A.parentNode):A).addClassName(this.options.activeClassName);this.activeContainer=this.containers.get(A.key);this.activeLink=A;this.options.showFunction(this.containers.get(A.key));this.notify("afterChange",this.containers.get(A.key))}}},next:function(){this.links.each(function(B,A){if(this.activeLink==B&&this.links[A+1]){this.setActiveTab(this.links[A+1]);throw $break}}.bind(this))},previous:function(){this.links.each(function(B,A){if(this.activeLink==B&&this.links[A-1]){this.setActiveTab(this.links[A-1]);throw $break}}.bind(this))},first:function(){this.setActiveTab(this.links.first())},last:function(){this.setActiveTab(this.links.last())}});Object.extend(Control.Tabs,{instances:[],findByTabId:function(A){return Control.Tabs.instances.find(function(B){return B.links.find(function(C){return C.key==A})})}});Object.Event.extend(Control.Tabs);